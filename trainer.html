<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title></title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
   body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .header {
        background: white;
        border-radius: 20px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    .header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: linear-gradient(90deg, #48bb78, #ed8936, #e53e3e);
    }
      .logo-img {
    height: 70px;
    width: auto;
    object-fit: contain;
    display: block;
    margin-right: 18px;
}
.logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 18px;
    margin-bottom: 15px;
}

    .activity-selector {
        padding: 30px;
        background: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
    }

    .activity-selector h2 {
        margin-bottom: 20px;
        color: #2c3e50;
    }

    .activity-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }

    .activity-btn {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        border: none;
        padding: 15px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        transition: all 0.3s ease;
        text-transform: capitalize;
    }

    .activity-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
    }

    .activity-btn.locked {
        background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        cursor: not-allowed;
        opacity: 0.6;
    }

    .activity-btn.locked:hover {
        transform: none;
        box-shadow: none;
    }

    .activity-btn.completed {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        position: relative;
    }

    .activity-btn.completed::after {
        content: '✓';
        position: absolute;
        top: 5px;
        right: 10px;
        font-size: 1.2em;
        font-weight: bold;
    }

    .activity-btn.current {
        background: linear-gradient(135deg, #f39c12, #e67e22);
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(243, 156, 18, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(243, 156, 18, 0); }
        100% { box-shadow: 0 0 0 0 rgba(243, 156, 18, 0); }
    }

    .progress-info {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 25px;
        text-align: center;
    }

    .progress-bar {
        background: #e9ecef;
        border-radius: 10px;
        height: 20px;
        margin: 15px 0;
        overflow: hidden;
    }

    .progress-fill {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        height: 100%;
        transition: width 0.5s ease;
        border-radius: 10px;
    }

    .level-stats {
        display: flex;
        justify-content: space-around;
        margin-top: 15px;
        font-size: 0.9em;
        color: #7f8c8d;
    }

    .next-level-btn {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        font-size: 1em;
        cursor: pointer;
        margin: 20px auto;
        display: block;
        transition: all 0.3s ease;
        animation: bounce 1s infinite;
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-5px); }
        60% { transform: translateY(-3px); }
    }

    .next-level-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
    }

    .activity-content {
        padding: 40px;
        min-height: 400px;
    }

    .activity-title {
        font-size: 1.8em;
        color: #2c3e50;
        margin-bottom: 20px;
        text-align: center;
    }

    .question {
        font-size: 1.2em;
        margin-bottom: 30px;
        line-height: 1.6;
        color: #34495e;
    }

    /* Visual Choice Styles */
    .visual-choices {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .choice-card {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .choice-card:hover {
        border-color: #3498db;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .choice-icon {
        font-size: 3em;
        margin-bottom: 15px;
    }

    .choice-text {
        font-weight: 600;
        color: #2c3e50;
    }

    /* Slider Styles */
    .slider-container {
        margin: 30px 0;
    }

    .slider {
        width: 100%;
        height: 8px;
        border-radius: 5px;
        background: #ddd;
        outline: none;
        margin: 20px 0;
    }

    .slider::-webkit-slider-thumb {
        appearance: none;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #3498db;
        cursor: pointer;
    }

    .slider-value {
        text-align: center;
        font-size: 1.5em;
        font-weight: bold;
        color: #3498db;
        margin: 15px 0;
    }

    /* Multi-step Calculator */
    .calc-variables {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 25px;
        margin: 20px 0;
    }

    .variable-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #e9ecef;
    }

    .variable-item:last-child {
        border-bottom: none;
    }

    .variable-value {
        font-weight: bold;
        color: #2c3e50;
    }

    .positive {
        color: #27ae60;
    }

    .negative {
        color: #e74c3c;
    }

    .calc-input {
        width: 200px;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 1.1em;
        text-align: center;
        margin: 20px auto;
        display: block;
    }

    /* Card Matching */
    .matching-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin: 30px 0;
    }

    .card-column {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        min-height: 300px;
    }

    .card-column h3 {
        text-align: center;
        margin-bottom: 20px;
        color: #2c3e50;
    }

    .draggable-card {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin: 10px 0;
        cursor: move;
        transition: all 0.3s ease;
    }

    .draggable-card:hover {
        border-color: #3498db;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    .drop-zone {
        background: #ecf0f1;
        border: 2px dashed #bdc3c7;
        border-radius: 8px;
        padding: 15px;
        margin: 10px 0;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #7f8c8d;
        transition: all 0.3s ease;
    }

    .drop-zone.drag-over {
        border-color: #3498db;
        background: #e3f2fd;
    }

    .drop-zone.filled {
        background: #d5f4e6;
        border-color: #27ae60;
        color: #27ae60;
    }

    /* Submit Button */
    .submit-btn {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        color: white;
        border: none;
        padding: 15px 40px;
        border-radius: 8px;
        font-size: 1.1em;
        cursor: pointer;
        display: block;
        margin: 30px auto 0;
        transition: all 0.3s ease;
    }

    .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
    }

    /* Alert Styles */
    .alert {
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
        font-weight: 600;
        text-align: center;
    }

    .alert.success {
        background: #d5f4e6;
        color: #27ae60;
        border: 2px solid #27ae60;
    }

    .alert.error {
        background: #fdeaea;
        color: #e74c3c;
        border: 2px solid #e74c3c;
    }

    /* Achievement Badges */
    .achievements {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin: 15px 0;
        flex-wrap: wrap;
    }

    .badge {
        background: linear-gradient(135deg, #f39c12, #e67e22);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: bold;
        animation: badgeGlow 2s infinite;
    }

    @keyframes badgeGlow {
        0%, 100% { box-shadow: 0 0 5px rgba(243, 156, 18, 0.5); }
        50% { box-shadow: 0 0 20px rgba(243, 156, 18, 0.8); }
    }

    /* Performance Dashboard */
    .performance-dashboard {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
    }

    .stat-card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .stat-value {
        font-size: 2em;
        font-weight: bold;
        color: #3498db;
    }

    .stat-label {
        color: #7f8c8d;
        font-size: 0.9em;
        margin-top: 5px;
    }

    /* Hint System */
    .hint-container {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 15px;
        margin: 20px 0;
        display: none;
    }

    .hint-btn {
        background: #f39c12;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9em;
        margin: 10px 0;
    }

    .hint-btn:hover {
        background: #e67e22;
    }

    /* Explanation Panel */
    .explanation-panel {
        background: #e8f5e8;
        border: 2px solid #27ae60;
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        display: none;
    }

    .explanation-title {
        font-weight: bold;
        color: #27ae60;
        margin-bottom: 10px;
    }

    .why-btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9em;
        margin: 10px 5px;
    }

    .why-btn:hover {
        background: #2980b9;
    }

    /* Timer Display */
    .timer-display {
        text-align: center;
        font-size: 1.2em;
        font-weight: bold;
        color: #e74c3c;
        margin: 15px 0;
        display: none;
    }

    /* Streak Counter */
    .streak-display {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        display: inline-block;
        font-weight: bold;
        margin: 10px;
    }

    /* Sound Toggle */
    .sound-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #3498db;
        color: white;
        border: none;
        padding: 10px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2em;
        z-index: 1000;
    }

    .sound-toggle:hover {
        background: #2980b9;
    }

    /* Dark Mode */
    .dark-mode-toggle {
        position: fixed;
        top: 20px;
        right: 80px;
        background: #34495e;
        color: white;
        border: none;
        padding: 10px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2em;
        z-index: 1000;
    }

    .dark-mode-toggle:hover {
        background: #2c3e50;
    }

    body.dark-mode {
        background: linear-gradient(135deg, #2c3e50, #34495e);
    }

    body.dark-mode .container {
        background: #34495e;
        color: white;
    }

    body.dark-mode .activity-selector {
        background: #2c3e50;
    }

    body.dark-mode .progress-info {
        background: #2c3e50;
    }

    body.dark-mode .choice-card {
        background: #34495e;
        border-color: #4a6741;
        color: white;
    }

    /* Retry Button */
    .retry-btn {
        background: linear-gradient(135deg, #e67e22, #d35400);
        color: white;
        border: none;
        padding: 10px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9em;
        margin: 10px 5px;
    }
          .fixed-buttons {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 9999;
            color: white;
        }

    .retry-btn:hover {
        background: linear-gradient(135deg, #d35400, #c0392b);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .container {
            margin: 10px;
        }
        
        .header {
            padding: 20px;
        }
        
        .header h1 {
            font-size: 2em;
        }
        
        .activity-content {
            padding: 20px;
        }
        
        .matching-container {
            grid-template-columns: 1fr;
        }

        .performance-dashboard {
            grid-template-columns: repeat(2, 1fr);
        }

        .sound-toggle, .dark-mode-toggle {
            position: relative;
            top: auto;
            right: auto;
            margin: 5px;
        }

    }
        .btn-secondary {
        background: linear-gradient(135deg, #ed8936, #dd6b20);
        color: white;
        border-radius: 50%;

        padding: 15px 30px;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 8px;
        position: relative;
        overflow: hidden;
    }
    .btn-secondary:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(237, 137, 54, 0.4);
    }
</style>
<body>
<div class="container">
    <div class="header">
         <div class="logo">
            <img src="img\siox black logo.png" alt="SIOX GLOBAL Logo" class="logo-img" />
        </div>
        <div style="color: #666; margin-bottom: 20px;">Auto-Progressive Interactive Learning</div>
        <div class="achievements" id="achievements"></div>
          <div class="fixed-buttons">
  <button onclick="goBackToMain()" class="btn-secondary">Main Page</button>
</div>
    </div>

    <div class="activity-selector">
        <h2>Freight Broker Training Levels</h2>
        <div class="progress-info" id="progressInfo"></div>
        <div class="performance-dashboard" id="performanceDashboard"></div>
        <div class="activity-buttons" id="activityButtons"></div>
    </div>

    <div class="activity-content" id="activityContent">
        <p style="text-align: center; color: #7f8c8d; font-size: 1.2em;">Select an activity above to begin training</p>
    </div>
</div>

<script>
    // Training levels data structure - progressive difficulty with more beginner content
    const trainingLevels = [
        // Level 1 - What is Freight Brokerage
        {
            type: 'visual-choice',
            level: 1,
            title: 'Level 1: Freight Brokerage Basics',
            question: 'What is the primary role of a freight broker?',
            choices: [
                { icon: '🚛', text: 'Own and operate trucks', correct: false },
                { icon: '🤝', text: 'Connect shippers with carriers', correct: true },
                { icon: '📦', text: 'Manufacture products', correct: false },
                { icon: '🏪', text: 'Sell goods to consumers', correct: false }
            ],
            explanation: 'Freight brokers act as intermediaries, connecting companies that need to ship goods (shippers) with trucking companies that can transport them (carriers). They don\'t own trucks or manufacture products.',
            hint: 'Think about what the word "broker" means - someone who brings two parties together.',
            timeLimit: 60
        },
        // Level 2 - Basic Terminology
        {
            type: 'card-matching',
            level: 2,
            title: 'Level 2: Industry Terminology',
            question: 'Match each freight term with its definition:',
            leftCards: [
                { id: 'shipper', text: 'Shipper' },
                { id: 'carrier', text: 'Carrier' },
                { id: 'consignee', text: 'Consignee' }
            ],
            rightCards: [
                { id: 'shipper', text: 'Company that needs goods transported' },
                { id: 'carrier', text: 'Company that provides transportation' },
                { id: 'consignee', text: 'Company receiving the goods' }
            ]
        },
        // Level 3 - Basic Documentation
        {
            type: 'visual-choice',
            level: 3,
            title: 'Level 3: Essential Documents',
            question: 'Which document serves as the contract between shipper and carrier?',
            choices: [
                { icon: '📋', text: 'Bill of Lading', correct: true },
                { icon: '💰', text: 'Invoice', correct: false },
                { icon: '📄', text: 'Packing List', correct: false },
                { icon: '🚚', text: 'Delivery Receipt', correct: false }
            ]
        },
        // Level 4 - Equipment Types
        {
            type: 'visual-choice',
            level: 4,
            title: 'Level 4: Truck Equipment Types',
            question: 'What type of trailer is best for transporting refrigerated goods?',
            choices: [
                { icon: '📦', text: 'Dry Van', correct: false },
                { icon: '🧊', text: 'Reefer (Refrigerated)', correct: true },
                { icon: '🚛', text: 'Flatbed', correct: false },
                { icon: '🚚', text: 'Step Deck', correct: false }
            ]
        },
        // Level 5 - Simple Rate Calculation
        {
            type: 'slider-input',
            level: 5,
            title: 'Level 5: Basic Rate Calculation',
            question: 'A 200-mile load costs $400 total. What is the rate per mile?',
            min: 1.50,
            max: 2.50,
            step: 0.05,
            correct: 2.00,
            tolerance: 0.05,
            unit: '$'
        },
        // Level 6 - Customer Communication
        {
            type: 'scenario-visual',
            level: 6,
            title: 'Level 6: Professional Communication',
            question: 'A new shipper asks about your services. What\'s the best first response?',
            choices: [
                { icon: '💰', text: 'Immediately quote the lowest possible rate', correct: false },
                { icon: '❓', text: 'Ask about their shipping needs and requirements', correct: true },
                { icon: '📞', text: 'Transfer them to someone else', correct: false },
                { icon: '📧', text: 'Send them a generic email', correct: false }
            ]
        },
        // Level 7 - Load Board Basics
        {
            type: 'visual-choice',
            level: 7,
            title: 'Level 7: Load Board Fundamentals',
            question: 'What information is most important when posting a load?',
            choices: [
                { icon: '📍', text: 'Pickup and delivery locations', correct: true },
                { icon: '🎨', text: 'Company logo design', correct: false },
                { icon: '📱', text: 'Broker\'s personal phone number', correct: false },
                { icon: '🏢', text: 'Office building photos', correct: false }
            ]
        },
        // Level 8 - Basic Profit Calculation
        {
            type: 'multi-step-calc',
            level: 8,
            title: 'Level 8: Simple Profit Analysis',
            question: 'Calculate your profit on this basic load:',
            variables: [
                { name: 'Shipper Pays You', value: 1500, type: 'positive' },
                { name: 'You Pay Carrier', value: -1200, type: 'negative' },
                { name: 'Fuel Surcharge', value: 75, type: 'positive' }
            ],
            correct: 375
        },
        // Level 9 - Carrier Vetting
        {
            type: 'visual-choice',
            level: 9,
            title: 'Level 9: Carrier Selection',
            question: 'What\'s the most important thing to verify before hiring a carrier?',
            choices: [
                { icon: '🚛', text: 'Truck color and brand', correct: false },
                { icon: '📋', text: 'Valid insurance and authority', correct: true },
                { icon: '📱', text: 'Driver\'s social media', correct: false },
                { icon: '🏠', text: 'Company office location', correct: false }
            ]
        },
        // Level 10 - Delivery Tracking
        {
            type: 'scenario-visual',
            level: 10,
            title: 'Level 10: Shipment Tracking',
            question: 'A shipper asks for an update on their delivery. The driver isn\'t answering calls. What do you do?',
            choices: [
                { icon: '🤷', text: 'Tell shipper you don\'t know', correct: false },
                { icon: '📞', text: 'Keep trying different contact methods and update shipper', correct: true },
                { icon: '😴', text: 'Wait until tomorrow to follow up', correct: false },
                { icon: '📧', text: 'Send an automated email', correct: false }
            ]
        },
        // Level 11 - Payment Terms
        {
            type: 'visual-choice',
            level: 11,
            title: 'Level 11: Payment Basics',
            question: 'What does "Net 30" payment terms mean?',
            choices: [
                { icon: '💰', text: 'Pay $30 total', correct: false },
                { icon: '📅', text: 'Payment due within 30 days', correct: true },
                { icon: '📊', text: '30% discount available', correct: false },
                { icon: '🚛', text: '30 trucks required', correct: false }
            ]
        },
        // Level 12 - Market Rates
        {
            type: 'slider-input',
            level: 12,
            title: 'Level 12: Market Rate Understanding',
            question: 'Current market rate is $2.20/mile. A carrier asks for $2.50/mile. What should you counter-offer?',
            min: 2.10,
            max: 2.40,
            step: 0.05,
            correct: 2.25,
            tolerance: 0.10,
            unit: '$'
        },
        // Level 13 - Problem Solving
        {
            type: 'scenario-visual',
            level: 13,
            title: 'Level 13: Basic Problem Solving',
            question: 'A carrier calls saying they\'ll be 2 hours late for pickup. What\'s your first action?',
            choices: [
                { icon: '😡', text: 'Get angry and find a new carrier', correct: false },
                { icon: '📞', text: 'Immediately call the shipper to inform them', correct: true },
                { icon: '📝', text: 'Write a complaint report', correct: false },
                { icon: '💰', text: 'Reduce the carrier\'s pay', correct: false }
            ]
        },
        // Level 14 - Documentation Management
        {
            type: 'card-matching',
            level: 14,
            title: 'Level 14: Document Flow',
            question: 'Match each document with when it\'s typically used:',
            leftCards: [
                { id: 'rate_confirmation', text: 'Rate Confirmation' },
                { id: 'bol', text: 'Bill of Lading' },
                { id: 'pod', text: 'Proof of Delivery' },
                { id: 'invoice', text: 'Invoice' }
            ],
            rightCards: [
                { id: 'rate_confirmation', text: 'Before pickup - confirms rate' },
                { id: 'bol', text: 'At pickup - shipping contract' },
                { id: 'pod', text: 'At delivery - confirms completion' },
                { id: 'invoice', text: 'After delivery - requests payment' }
            ]
        },
        // Level 15 - Negotiation Basics
        {
            type: 'negotiation-visual',
            level: 15,
            title: 'Level 15: Basic Negotiation',
            question: 'A carrier wants $200 more than your budget allows. What\'s the best approach?',
            choices: [
                { icon: '❌', text: 'Immediately say no and hang up', correct: false },
                { icon: '💬', text: 'Ask why they need the extra money and explain your position', correct: true },
                { icon: '💰', text: 'Always pay whatever they ask', correct: false },
                { icon: '🔍', text: 'Find their competitor immediately', correct: false }
            ]
        },
        // Level 16 - Advanced Profit Analysis
        {
            type: 'multi-step-calc',
            level: 16,
            title: 'Level 16: Detailed Profit Analysis',
            question: 'Calculate the final profit for this load:',
            variables: [
                { name: 'Shipper Payment', value: 2200, type: 'positive' },
                { name: 'Carrier Cost', value: -1650, type: 'negative' },
                { name: 'Fuel Surcharge', value: 120, type: 'positive' },
                { name: 'Broker Fee', value: -150, type: 'negative' },
                { name: 'Insurance', value: -45, type: 'negative' }
            ],
            correct: 475
        },
        // Level 17 - Crisis Management
        {
            type: 'crisis-scenario',
            level: 17,
            title: 'Level 17: Emergency Response',
            question: 'A truck carrying hazardous materials has broken down on a major highway. What\'s your immediate priority?',
            choices: [
                { icon: '📱', text: 'Call the shipper to inform them of delay', correct: false },
                { icon: '🚨', text: 'Ensure driver safety and contact emergency services', correct: true },
                { icon: '🚛', text: 'Arrange for another truck immediately', correct: false },
                { icon: '💼', text: 'Check insurance coverage first', correct: false }
            ]
        },
        // Level 18 - Strategic Planning
        {
            type: 'strategy-planning',
            level: 18,
            title: 'Level 18: Business Strategy',
            question: 'You have limited capacity. Choose between: $1200 load with reliable customer vs $1800 load with new customer who has payment issues history.',
            choices: [
                { icon: '🤝', text: 'Choose reliable customer for long-term relationship', correct: true },
                { icon: '💵', text: 'Always choose the higher paying load', correct: false },
                { icon: '🎲', text: 'Split capacity between both loads', correct: false },
                { icon: '📞', text: 'Negotiate payment terms with new customer', correct: false }
            ]
        },
        // Level 19 - Complex Rate Calculation
        {
            type: 'slider-input',
            level: 19,
            title: 'Level 19: Advanced Rate Calculation',
            question: 'Complex load: 750 miles, hazmat surcharge +$0.25/mile, fuel at $4.80/gallon (6 MPG), driver detention 4hrs at $35/hr, 20% margin needed. Calculate rate per mile:',
            min: 1.20,
            max: 2.00,
            step: 0.05,
            correct: 1.55,
            tolerance: 0.10,
            unit: '$'
        },
        // Level 20 - Master Level
        {
            type: 'multi-step-calc',
            level: 20,
            title: 'Level 20: Master Broker Challenge',
            question: 'Multi-load profit analysis - calculate total profit across all loads:',
            variables: [
                { name: 'Load 1 Revenue', value: 2800, type: 'positive' },
                { name: 'Load 1 Carrier Cost', value: -2100, type: 'negative' },
                { name: 'Load 2 Revenue', value: 1950, type: 'positive' },
                { name: 'Load 2 Carrier Cost', value: -1500, type: 'negative' },
                { name: 'Load 3 Revenue', value: 3200, type: 'positive' },
                { name: 'Load 3 Carrier Cost', value: -2400, type: 'negative' },
                { name: 'Total Fuel Surcharges', value: 380, type: 'positive' },
                { name: 'Administrative Costs', value: -275, type: 'negative' },
                { name: 'Insurance Costs', value: -125, type: 'negative' }
            ],
            correct: 1930
        }
    ];

    // Legacy activities object for backward compatibility
    const activities = {
        'scenario-visual': {
            title: 'Customer Service Scenario',
            question: 'A shipper calls upset because their freight is delayed by 2 days due to weather. How do you respond?',
            choices: [
                { icon: '😤', text: 'Tell them weather delays are not your fault', correct: false },
                { icon: '🤝', text: 'Apologize, explain the situation, and offer solutions', correct: true },
                { icon: '📞', text: 'Transfer them to your supervisor immediately', correct: false },
                { icon: '⏰', text: 'Promise it will never happen again', correct: false }
            ]
        },
        'negotiation-visual': {
            title: 'Rate Negotiation Strategy',
            question: 'A carrier is asking for $200 more than your budgeted rate. What\'s your best negotiation approach?',
            choices: [
                { icon: '❌', text: 'Immediately reject and find another carrier', correct: false },
                { icon: '💰', text: 'Offer to meet halfway and explain market conditions', correct: true },
                { icon: '📊', text: 'Accept their rate without negotiation', correct: false },
                { icon: '⚡', text: 'Threaten to never work with them again', correct: false }
            ]
        },
        'crisis-scenario': {
            title: 'Crisis Management',
            question: 'A truck carrying hazardous materials has broken down on a major highway. What\'s your immediate priority?',
            choices: [
                { icon: '📱', text: 'Call the shipper to inform them of delay', correct: false },
                { icon: '🚨', text: 'Ensure driver safety and contact emergency services', correct: true },
                { icon: '🚛', text: 'Arrange for another truck immediately', correct: false },
                { icon: '💼', text: 'Check insurance coverage first', correct: false }
            ]
        },
        'strategy-planning': {
            title: 'Business Strategy',
            question: 'You have limited capacity and two potential loads. One pays $1000 with a reliable customer, another pays $1500 with a new customer. Which do you choose?',
            choices: [
                { icon: '🤝', text: 'Choose the reliable customer for long-term relationship', correct: true },
                { icon: '💵', text: 'Always choose the higher paying load', correct: false },
                { icon: '🎲', text: 'Flip a coin to decide', correct: false },
                { icon: '📞', text: 'Try to negotiate both loads', correct: false }
            ]
        },
        'slider-input': {
            title: 'Rate Calculation',
            question: 'Calculate the appropriate rate per mile for a 500-mile load with fuel costs at $4.50/gallon, driver pay at $0.60/mile, and desired profit margin of 15%. What should your rate per mile be?',
            min: 1.50,
            max: 3.50,
            step: 0.05,
            correct: 2.25,
            tolerance: 0.10,
            unit: '$'
        },
        'multi-step-calc': {
            title: 'Load Profitability Analysis',
            question: 'Calculate the final profit/loss for this load based on the following variables:',
            variables: [
                { name: 'Gross Revenue', value: 2500, type: 'positive' },
                { name: 'Carrier Payment', value: -1800, type: 'negative' },
                { name: 'Fuel Surcharge', value: 150, type: 'positive' },
                { name: 'Broker Commission', value: -200, type: 'negative' },
                { name: 'Insurance Cost', value: -75, type: 'negative' },
                { name: 'Administrative Fee', value: -50, type: 'negative' }
            ],
            correct: 525
        },
        'card-matching': {
            title: 'Document Matching',
            question: 'Match each freight document with its primary purpose:',
            leftCards: [
                { id: 'bol', text: 'Bill of Lading' },
                { id: 'pod', text: 'Proof of Delivery' },
                { id: 'invoice', text: 'Freight Invoice' },
                { id: 'manifest', text: 'Cargo Manifest' }
            ],
            rightCards: [
                { id: 'bol', text: 'Legal contract for transportation' },
                { id: 'pod', text: 'Confirms successful delivery' },
                { id: 'invoice', text: 'Request for payment' },
                { id: 'manifest', text: 'Detailed cargo inventory' }
            ]
        }
    };

    let currentLevel = 1;
    let maxUnlockedLevel = 1;
    let currentActivity = null;
    let userAnswers = {};
    let levelProgress = {};
    let userStats = {
        totalAttempts: 0,
        correctAnswers: 0,
        currentStreak: 0,
        bestStreak: 0,
        totalTimeSpent: 0,
        averageTime: 0,
        badges: []
    };
    let soundEnabled = true;
    let timerInterval = null;
    let startTime = null;

    // Initialize the application
    function init() {
        loadProgress();
        loadUserStats();
        renderProgressInfo();
        renderPerformanceDashboard();
        renderAchievements();
        renderLevelButtons();
        loadCurrentLevel();
        checkForNewBadges();
    }

    // Load progress from localStorage
    function loadProgress() {
        const saved = localStorage.getItem('freightBrokerProgress');
        if (saved) {
            const progress = JSON.parse(saved);
            maxUnlockedLevel = progress.maxUnlockedLevel || 1;
            levelProgress = progress.levelProgress || {};
            currentLevel = progress.currentLevel || 1;
        }
    }

    // Load user statistics
    function loadUserStats() {
        const saved = localStorage.getItem('freightBrokerStats');
        if (saved) {
            userStats = { ...userStats, ...JSON.parse(saved) };
        }
    }

    // Save user statistics
    function saveUserStats() {
        localStorage.setItem('freightBrokerStats', JSON.stringify(userStats));
    }

    // Play sound effects
    function playSound(type) {
        if (!soundEnabled) return;
        
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        if (type === 'correct') {
            // Success sound - ascending notes
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        } else if (type === 'incorrect') {
            // Error sound - descending notes
            oscillator.frequency.setValueAtTime(392.00, audioContext.currentTime); // G4
            oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime + 0.1); // E4
            oscillator.frequency.setValueAtTime(261.63, audioContext.currentTime + 0.2); // C4
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        } else if (type === 'levelUp') {
            // Level up sound - triumphant
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
            oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.3); // C6
            gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }
    }

    // Toggle sound on/off
    function toggleSound() {
        soundEnabled = !soundEnabled;
        const button = document.querySelector('.sound-toggle');
        button.textContent = soundEnabled ? '🔊' : '🔇';
        button.title = soundEnabled ? 'Turn Sound Off' : 'Turn Sound On';
    }

    // Toggle dark mode
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        const button = document.querySelector('.dark-mode-toggle');
        const isDark = document.body.classList.contains('dark-mode');
        button.textContent = isDark ? '☀️' : '🌙';
        button.title = isDark ? 'Light Mode' : 'Dark Mode';
        localStorage.setItem('darkMode', isDark);
    }

    // Start timer for level
    function startTimer(timeLimit) {
        if (!timeLimit) return;
        
        startTime = Date.now();
        const timerDisplay = document.getElementById('timerDisplay');
        if (timerDisplay) {
            timerDisplay.style.display = 'block';
            let timeLeft = timeLimit;
            
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `⏰ Time: ${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitAnswer(true); // Auto-submit when time runs out
                }
            }, 1000);
        }
    }

    // Stop timer
    function stopTimer() {
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
        }
        const timerDisplay = document.getElementById('timerDisplay');
        if (timerDisplay) {
            timerDisplay.style.display = 'none';
        }
    }

    // Save progress to localStorage
    function saveProgress() {
        const progress = {
            maxUnlockedLevel,
            levelProgress,
            currentLevel
        };
        localStorage.setItem('freightBrokerProgress', JSON.stringify(progress));
    }

    // Render progress information
    function renderProgressInfo() {
        const progressContainer = document.getElementById('progressInfo');
        const completedLevels = Object.keys(levelProgress).filter(level => levelProgress[level]).length;
        const progressPercentage = (completedLevels / trainingLevels.length) * 100;

        progressContainer.innerHTML = `
            <h3>Training Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${progressPercentage}%"></div>
            </div>
            <div class="level-stats">
                <span>Current Level: ${currentLevel}</span>
                <span>Completed: ${completedLevels}/${trainingLevels.length}</span>
                <span>Progress: ${Math.round(progressPercentage)}%</span>
            </div>
            ${userStats.currentStreak > 0 ? `<div class="streak-display">🔥 ${userStats.currentStreak} Day Streak!</div>` : ''}
        `;
    }

    // Render performance dashboard
    function renderPerformanceDashboard() {
        const dashboard = document.getElementById('performanceDashboard');
        const accuracy = userStats.totalAttempts > 0 ? Math.round((userStats.correctAnswers / userStats.totalAttempts) * 100) : 0;
        const avgTime = userStats.averageTime > 0 ? Math.round(userStats.averageTime) : 0;

        dashboard.innerHTML = `
            <div class="stat-card">
                <div class="stat-value">${accuracy}%</div>
                <div class="stat-label">Accuracy</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${userStats.bestStreak}</div>
                <div class="stat-label">Best Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${avgTime}s</div>
                <div class="stat-label">Avg Time</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${userStats.badges.length}</div>
                <div class="stat-label">Badges</div>
            </div>
        `;
    }

    // Render achievements
    function renderAchievements() {
        const achievementsContainer = document.getElementById('achievements');
        if (userStats.badges.length === 0) {
            achievementsContainer.innerHTML = '';
            return;
        }

        const badgeHTML = userStats.badges.map(badge => 
            `<div class="badge" title="${badge.description}">${badge.icon} ${badge.name}</div>`
        ).join('');

        achievementsContainer.innerHTML = badgeHTML;
    }

    // Check for new badges
    function checkForNewBadges() {
        const newBadges = [];
        
        // First Steps badge
        if (userStats.correctAnswers >= 1 && !userStats.badges.find(b => b.id === 'first_steps')) {
            newBadges.push({
                id: 'first_steps',
                name: 'First Steps',
                icon: '👶',
                description: 'Answered your first question correctly'
            });
        }

        // Speed Demon badge
        if (userStats.averageTime <= 30 && userStats.totalAttempts >= 5 && !userStats.badges.find(b => b.id === 'speed_demon')) {
            newBadges.push({
                id: 'speed_demon',
                name: 'Speed Demon',
                icon: '⚡',
                description: 'Average answer time under 30 seconds'
            });
        }

        // Perfectionist badge
        if (userStats.totalAttempts >= 10 && (userStats.correctAnswers / userStats.totalAttempts) >= 0.9 && !userStats.badges.find(b => b.id === 'perfectionist')) {
            newBadges.push({
                id: 'perfectionist',
                name: 'Perfectionist',
                icon: '💎',
                description: '90% accuracy with 10+ attempts'
            });
        }

        // Streak Master badge
        if (userStats.bestStreak >= 5 && !userStats.badges.find(b => b.id === 'streak_master')) {
            newBadges.push({
                id: 'streak_master',
                name: 'Streak Master',
                icon: '🔥',
                description: '5+ correct answers in a row'
            });
        }

        // Add new badges
        newBadges.forEach(badge => {
            userStats.badges.push(badge);
            showBadgeNotification(badge);
        });

        if (newBadges.length > 0) {
            saveUserStats();
            renderAchievements();
        }
    }

    // Show badge notification
    function showBadgeNotification(badge) {
        const notification = document.createElement('div');
        notification.className = 'alert success';
        notification.innerHTML = `
            <h3>🎉 New Badge Earned! 🎉</h3>
            <p>${badge.icon} <strong>${badge.name}</strong></p>
            <p>${badge.description}</p>
        `;
        
        document.body.appendChild(notification);
        notification.style.position = 'fixed';
        notification.style.top = '50%';
        notification.style.left = '50%';
        notification.style.transform = 'translate(-50%, -50%)';
        notification.style.zIndex = '10000';
        notification.style.animation = 'bounce 0.5s ease-in-out';

        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    // Render level selection buttons
    function renderLevelButtons() {
        const buttonsContainer = document.getElementById('activityButtons');
        buttonsContainer.innerHTML = '';

        trainingLevels.forEach(level => {
            const button = document.createElement('button');
            button.className = 'activity-btn';
            
            // Determine button state
            if (level.level > maxUnlockedLevel) {
                button.className += ' locked';
                button.disabled = true;
            } else if (levelProgress[level.level]) {
                button.className += ' completed';
            } else if (level.level === currentLevel) {
                button.className += ' current';
            }

            button.textContent = `Level ${level.level}: ${level.title.split(': ')[1]}`;
            
            if (level.level <= maxUnlockedLevel) {
                button.onclick = () => loadLevel(level.level);
            }
            
            buttonsContainer.appendChild(button);
        });
    }

    // Load current level automatically
    function loadCurrentLevel() {
        if (currentLevel <= trainingLevels.length) {
            loadLevel(currentLevel);
        }
    }

    // Load and render specific level
    function loadLevel(levelNumber) {
        currentLevel = levelNumber;
        const level = trainingLevels.find(l => l.level === levelNumber);
        if (!level) return;

        currentActivity = level.type;
        userAnswers = {};
        const contentContainer = document.getElementById('activityContent');

        let html = `<h2 class="activity-title">${level.title}</h2>`;
        html += `<div class="question">${level.question}</div>`;

        switch (level.type) {
            case 'visual-choice':
            case 'scenario-visual':
            case 'negotiation-visual':
            case 'crisis-scenario':
            case 'strategy-planning':
                html += renderVisualChoices(level.choices);
                break;
            case 'slider-input':
                html += renderSliderInput(level);
                break;
            case 'multi-step-calc':
                html += renderMultiStepCalc(level);
                break;
            case 'card-matching':
                html += renderCardMatching(level);
                break;
        }

        // Add hint and explanation buttons
        html += '<div class="hint-container" id="hintContainer">';
        if (level.hint) {
            html += `<button class="hint-btn" onclick="showHint()">💡 Need a Hint?</button>`;
            html += `<div id="hintText" style="display: none; margin-top: 10px; font-style: italic;">${level.hint}</div>`;
        }
        html += '</div>';

        // Add timer display
        if (level.timeLimit) {
            html += '<div class="timer-display" id="timerDisplay"></div>';
        }

        html += '<button class="submit-btn" onclick="submitAnswer()">Submit Answer</button>';

        // Add explanation panel (hidden initially)
        if (level.explanation) {
            html += `
                <div class="explanation-panel" id="explanationPanel">
                    <div class="explanation-title">Why is this correct?</div>
                    <div>${level.explanation}</div>
                </div>
            `;
        }

        contentContainer.innerHTML = html;

        // Initialize drag and drop for card matching
        if (level.type === 'card-matching') {
            initializeDragAndDrop();
        }

        // Start timer if applicable
        if (level.timeLimit) {
            startTimer(level.timeLimit);
        }
    }

    // Render visual choice interface
    function renderVisualChoices(choices) {
        let html = '<div class="visual-choices">';
        choices.forEach((choice, index) => {
            html += `
                <div class="choice-card" onclick="selectChoice(${index})">
                    <div class="choice-icon">${choice.icon}</div>
                    <div class="choice-text">${choice.text}</div>
                </div>
            `;
        });
        html += '</div>';
        return html;
    }

    // Render slider input interface
    function renderSliderInput(activity) {
        const midpoint = (activity.min + activity.max) / 2;
        return `
            <div class="slider-container">
                <div class="slider-value" id="sliderValue">${activity.unit}${midpoint.toFixed(2)}</div>
                <input type="range" 
                       class="slider" 
                       id="priceSlider"
                       min="${activity.min}" 
                       max="${activity.max}" 
                       step="${activity.step}" 
                       value="${midpoint}"
                       oninput="updateSliderValue(this.value, '${activity.unit}')">
                <div style="display: flex; justify-content: space-between; color: #7f8c8d;">
                    <span>${activity.unit}${activity.min}</span>
                    <span>${activity.unit}${activity.max}</span>
                </div>
            </div>
        `;
    }

    // Render multi-step calculator interface
    function renderMultiStepCalc(activity) {
        let html = '<div class="calc-variables">';
        activity.variables.forEach(variable => {
            const className = variable.type === 'positive' ? 'positive' : 'negative';
            const sign = variable.value >= 0 ? '+' : '';
            html += `
                <div class="variable-item">
                    <span>${variable.name}</span>
                    <span class="variable-value ${className}">${sign}$${variable.value}</span>
                </div>
            `;
        });
        html += '</div>';
        html += '<input type="number" class="calc-input" id="calcResult" placeholder="Enter your calculated result">';
        return html;
    }

    // Render card matching interface
    function renderCardMatching(activity) {
        let html = '<div class="matching-container">';
        
        // Left column - draggable cards
        html += '<div class="card-column"><h3>Documents</h3>';
        activity.leftCards.forEach(card => {
            html += `<div class="draggable-card" draggable="true" data-id="${card.id}">${card.text}</div>`;
        });
        html += '</div>';

        // Right column - drop zones
        html += '<div class="card-column"><h3>Purposes</h3>';
        activity.rightCards.forEach(card => {
            html += `<div class="drop-zone" data-id="${card.id}">Drop here: ${card.text}</div>`;
        });
        html += '</div>';

        html += '</div>';
        return html;
    }

    // Handle choice selection for visual activities
    function selectChoice(index) {
        // Remove previous selections
        document.querySelectorAll('.choice-card').forEach(card => {
            card.style.backgroundColor = '';
            card.style.borderColor = '#e9ecef';
        });

        // Highlight selected choice
        const selectedCard = document.querySelectorAll('.choice-card')[index];
        selectedCard.style.backgroundColor = '#e3f2fd';
        selectedCard.style.borderColor = '#3498db';

        userAnswers.selectedChoice = index;
    }

    // Update slider value display
    function updateSliderValue(value, unit) {
        document.getElementById('sliderValue').textContent = `${unit}${parseFloat(value).toFixed(2)}`;
        userAnswers.sliderValue = parseFloat(value);
    }

    // Initialize drag and drop functionality
    function initializeDragAndDrop() {
        const draggableCards = document.querySelectorAll('.draggable-card');
        const dropZones = document.querySelectorAll('.drop-zone');

        draggableCards.forEach(card => {
            card.addEventListener('dragstart', handleDragStart);
        });

        dropZones.forEach(zone => {
            zone.addEventListener('dragover', handleDragOver);
            zone.addEventListener('drop', handleDrop);
            zone.addEventListener('dragenter', handleDragEnter);
            zone.addEventListener('dragleave', handleDragLeave);
        });
    }

    function handleDragStart(e) {
        e.dataTransfer.setData('text/plain', e.target.dataset.id);
    }

    function handleDragOver(e) {
        e.preventDefault();
    }

    function handleDragEnter(e) {
        e.target.classList.add('drag-over');
    }

    function handleDragLeave(e) {
        e.target.classList.remove('drag-over');
    }

    function handleDrop(e) {
        e.preventDefault();
        const draggedId = e.dataTransfer.getData('text/plain');
        const dropZoneId = e.target.dataset.id;
        
        e.target.classList.remove('drag-over');
        e.target.classList.add('filled');
        e.target.textContent = `Matched: ${document.querySelector(`[data-id="${draggedId}"]`).textContent}`;

        if (!userAnswers.matches) userAnswers.matches = {};
        userAnswers.matches[draggedId] = dropZoneId;
    }

    // Show hint function
    function showHint() {
        const hintText = document.getElementById('hintText');
        const hintBtn = document.querySelector('.hint-btn');
        
        if (hintText && hintBtn) {
            hintText.style.display = 'block';
            hintBtn.style.display = 'none';
        }
    }

    // Retry level function
    function retryLevel() {
        loadLevel(currentLevel);
    }

    // Unified answer submission handler
    function submitAnswer(timeUp = false) {
        const level = trainingLevels.find(l => l.level === currentLevel);
        if (!level) return;

        let isCorrect = false;
        let feedbackMessage = '';

        switch (level.type) {
            case 'visual-choice':
            case 'scenario-visual':
            case 'negotiation-visual':
            case 'crisis-scenario':
            case 'strategy-planning':
                if (userAnswers.selectedChoice !== undefined) {
                    isCorrect = level.choices[userAnswers.selectedChoice].correct;
                    feedbackMessage = isCorrect ? 
                        'Excellent! You selected the correct answer.' : 
                        'Not quite right. The correct answer focuses on best practices in freight brokerage.';
                } else {
                    feedbackMessage = 'Please select an answer before submitting.';
                }
                break;

            case 'slider-input':
                if (userAnswers.sliderValue !== undefined) {
                    const difference = Math.abs(userAnswers.sliderValue - level.correct);
                    isCorrect = difference <= level.tolerance;
                    feedbackMessage = isCorrect ? 
                        `Correct! The target rate was $${level.correct.toFixed(2)} per mile.` : 
                        `Close, but the optimal rate is $${level.correct.toFixed(2)} per mile. You were off by $${difference.toFixed(2)}.`;
                } else {
                    feedbackMessage = 'Please adjust the slider before submitting.';
                }
                break;

            case 'multi-step-calc':
                const calcInput = document.getElementById('calcResult');
                if (calcInput && calcInput.value) {
                    const userResult = parseInt(calcInput.value);
                    isCorrect = userResult === level.correct;
                    feedbackMessage = isCorrect ? 
                        `Perfect! The correct profit is $${level.correct}.` : 
                        `The correct calculation is $${level.correct}. Double-check your addition and subtraction.`;
                } else {
                    feedbackMessage = 'Please enter your calculated result.';
                }
                break;

            case 'card-matching':
                if (userAnswers.matches && Object.keys(userAnswers.matches).length === level.leftCards.length) {
                    let correctMatches = 0;
                    Object.keys(userAnswers.matches).forEach(draggedId => {
                        if (userAnswers.matches[draggedId] === draggedId) {
                            correctMatches++;
                        }
                    });
                    isCorrect = correctMatches === level.leftCards.length;
                    feedbackMessage = isCorrect ? 
                        'Perfect matching! You correctly paired all documents with their purposes.' : 
                        `You got ${correctMatches} out of ${level.leftCards.length} matches correct. Review freight documentation requirements.`;
                } else {
                    feedbackMessage = 'Please match all documents before submitting.';
                }
                break;
        }

        showFeedback(isCorrect, feedbackMessage, level);
    }

    // Display feedback to user with level progression
    function showFeedback(isCorrect, message, level) {
        // Stop timer
        stopTimer();

        // Update statistics
        userStats.totalAttempts++;
        if (isCorrect) {
            userStats.correctAnswers++;
            userStats.currentStreak++;
            if (userStats.currentStreak > userStats.bestStreak) {
                userStats.bestStreak = userStats.currentStreak;
            }
        } else {
            userStats.currentStreak = 0;
        }

        // Calculate time taken
        if (startTime) {
            const timeSpent = (Date.now() - startTime) / 1000;
            userStats.totalTimeSpent += timeSpent;
            userStats.averageTime = userStats.totalTimeSpent / userStats.totalAttempts;
        }

        // Play sound
        playSound(isCorrect ? 'correct' : 'incorrect');

        // Save stats
        saveUserStats();

        const existingAlert = document.querySelector('.alert');
        if (existingAlert) {
            existingAlert.remove();
        }

        const existingNextBtn = document.querySelector('.next-level-btn');
        if (existingNextBtn) {
            existingNextBtn.remove();
        }

        const existingRetryBtn = document.querySelector('.retry-btn');
        if (existingRetryBtn) {
            existingRetryBtn.remove();
        }

        const existingWhyBtn = document.querySelector('.why-btn');
        if (existingWhyBtn) {
            existingWhyBtn.remove();
        }

        const alert = document.createElement('div');
        alert.className = `alert ${isCorrect ? 'success' : 'error'}`;
        alert.textContent = message;

        const submitBtn = document.querySelector('.submit-btn');
        submitBtn.parentNode.insertBefore(alert, submitBtn);

        // Add explanation button if available
        if (level.explanation) {
            const whyBtn = document.createElement('button');
            whyBtn.className = 'why-btn';
            whyBtn.textContent = '🤔 Why?';
            whyBtn.onclick = () => {
                const explanationPanel = document.getElementById('explanationPanel');
                if (explanationPanel) {
                    explanationPanel.style.display = explanationPanel.style.display === 'none' ? 'block' : 'none';
                }
            };
            submitBtn.parentNode.insertBefore(whyBtn, submitBtn.nextSibling);
        }

        // Add retry button for incorrect answers
        if (!isCorrect) {
            const retryBtn = document.createElement('button');
            retryBtn.className = 'retry-btn';
            retryBtn.textContent = '🔄 Try Again';
            retryBtn.onclick = retryLevel;
            submitBtn.parentNode.insertBefore(retryBtn, submitBtn.nextSibling);
        }

        // Handle level progression for correct answers
        if (isCorrect) {
            // Mark current level as completed
            levelProgress[currentLevel] = true;
            
            // Unlock next level if not already unlocked
            if (currentLevel === maxUnlockedLevel && currentLevel < trainingLevels.length) {
                maxUnlockedLevel = currentLevel + 1;
                playSound('levelUp');
            }

            // Save progress
            saveProgress();

            // Add next level button or completion message
            if (currentLevel < trainingLevels.length) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'next-level-btn';
                nextBtn.textContent = `Continue to Level ${currentLevel + 1} →`;
                nextBtn.onclick = () => {
                    currentLevel++;
                    renderProgressInfo();
                    renderPerformanceDashboard();
                    renderLevelButtons();
                    loadLevel(currentLevel);
                    checkForNewBadges();
                };
                submitBtn.parentNode.insertBefore(nextBtn, submitBtn.nextSibling);
            } else {
                // All levels completed
                const completionMsg = document.createElement('div');
                completionMsg.className = 'alert success';
                completionMsg.innerHTML = `
                    <h3>🎉 Congratulations! 🎉</h3>
                    <p>You've completed all freight broker training levels!</p>
                    <p>You're now ready to handle real-world freight brokerage challenges.</p>
                    <p>Final Stats: ${userStats.correctAnswers}/${userStats.totalAttempts} correct (${Math.round((userStats.correctAnswers/userStats.totalAttempts)*100)}%)</p>
                `;
                
                // Add play again button
                const playAgainBtn = document.createElement('button');
                playAgainBtn.className = 'next-level-btn';
                playAgainBtn.textContent = '🔄 Play Again';
                playAgainBtn.style.background = 'linear-gradient(135deg, #3498db, #2980b9)';
                playAgainBtn.onclick = resetGame;
                
                submitBtn.parentNode.insertBefore(completionMsg, submitBtn.nextSibling);
                submitBtn.parentNode.insertBefore(playAgainBtn, submitBtn.nextSibling);
            }

            // Update UI
            renderProgressInfo();
            renderPerformanceDashboard();
            renderLevelButtons();
            checkForNewBadges();
        }

        // Auto-scroll to feedback
        alert.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // Reset game function
    function resetGame() {
        // Show confirmation dialog
        if (confirm('Are you sure you want to start over? This will reset all your progress but keep your badges and statistics.')) {
            // Reset progress but keep stats and badges
            currentLevel = 1;
            maxUnlockedLevel = 1;
            levelProgress = {};
            userAnswers = {};
            
            // Save the reset progress
            saveProgress();
            
            // Update UI
            renderProgressInfo();
            renderPerformanceDashboard();
            renderLevelButtons();
            loadLevel(1);
            
            // Show reset confirmation
            const alert = document.createElement('div');
            alert.className = 'alert success';
            alert.innerHTML = `
                <h3>🔄 Game Reset!</h3>
                <p>You can now play through all levels again while keeping your badges and statistics.</p>
            `;
            
            const contentContainer = document.getElementById('activityContent');
            contentContainer.insertBefore(alert, contentContainer.firstChild);
            
            // Auto-remove alert after 3 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 3000);
        }
    }

    // Initialize the application when page loads
    document.addEventListener('DOMContentLoaded', () => {
        // Load dark mode preference
        const darkMode = localStorage.getItem('darkMode');
        if (darkMode === 'true') {
            document.body.classList.add('dark-mode');
            document.querySelector('.dark-mode-toggle').textContent = '☀️';
        }
        
        init();
    });
     // ⬅️ Back Button Handler
        function goBackToMain() {
            window.location.href = "https://iridescent-manatee-6198a9.netlify.app/"; // Replace with your actual main page filename
        }
</script>
</body>
</html>
